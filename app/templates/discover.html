{% extends "base.html" %}

{% block title %}Discovery Lab - KinoPlex{% endblock %}

{% block content %}
<div class="container">
    <div class="glass-card">
        <h1>
            <i class="fas fa-flask"></i>
            Discovery Lab
        </h1>
        <p style="color: var(--text-secondary); margin-bottom: 3rem;">
            Advanced analysis tools for comparative phosphoproteomics and pathway discovery.
        </p>

        <!-- Analysis Tools Grid -->
        <div class="grid-2">
            <!-- Protein Comparison -->
            <div class="glass-card">
                <div class="feature-icon" style="width: 50px; height: 50px;">
                    <i class="fas fa-balance-scale"></i>
                </div>
                <h3>Protein Comparison</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    Compare phosphorylation profiles across multiple proteins side-by-side.
                </p>
                <div class="mb-3">
                    <label class="form-label">Enter Protein Names (one per line):</label>
                    <textarea class="form-control" id="protein-list" rows="4"
                              placeholder="TP53&#10;AKT1&#10;BRCA1&#10;CDK2"></textarea>
                </div>
                <button class="btn btn-primary" onclick="compareProteins()">
                    <i class="fas fa-chart-bar"></i>
                    Compare Proteins
                </button>
            </div>

            <!-- Pathway Enrichment -->
            <div class="glass-card">
                <div class="feature-icon" style="width: 50px; height: 50px;">
                    <i class="fas fa-network-wired"></i>
                </div>
                <h3>Pathway Enrichment</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    Find enriched pathways in your gene set for functional analysis.
                </p>
                <div class="mb-3">
                    <label class="form-label">Enter Gene List:</label>
                    <textarea class="form-control" id="gene-list" rows="4"
                              placeholder="TP53&#10;AKT1&#10;BRCA1&#10;CDK2&#10;GSK3B"></textarea>
                </div>
                <button class="btn btn-primary" onclick="analyzeEnrichment()">
                    <i class="fas fa-sitemap"></i>
                    Analyze Pathways
                </button>
            </div>

            <!-- Kinase Analysis -->
            <div class="glass-card">
                <div class="feature-icon" style="width: 50px; height: 50px;">
                    <i class="fas fa-cogs"></i>
                </div>
                <h3>Kinase Substrate Analysis</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    Predict and analyze kinase-substrate relationships across your dataset.
                </p>
                <div class="mb-3">
                    <label class="form-label">Select Kinase:</label>
                    <select class="form-control" id="kinase-select">
                        <option value="AKT1">AKT1</option>
                        <option value="CDK1">CDK1</option>
                        <option value="GSK3B">GSK3B</option>
                        <option value="ERK1">ERK1</option>
                        <option value="JNK1">JNK1</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="analyzeKinase()">
                    <i class="fas fa-search"></i>
                    Find Substrates
                </button>
            </div>

            <!-- Structural Analysis -->
            <div class="glass-card">
                <div class="feature-icon" style="width: 50px; height: 50px;">
                    <i class="fas fa-cube"></i>
                </div>
                <h3>Structural Context</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    Analyze structural features and patterns in phosphorylation sites.
                </p>
                <div class="mb-3">
                    <label class="form-label">Analysis Type:</label>
                    <select class="form-control" id="structure-type">
                        <option value="disorder">Intrinsic Disorder Analysis</option>
                        <option value="secondary">Secondary Structure Patterns</option>
                        <option value="surface">Surface Accessibility</option>
                        <option value="conservation">Conservation Analysis</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="analyzeStructure()">
                    <i class="fas fa-atom"></i>
                    Analyze Structure
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results-section" style="display: none; margin-top: 3rem;">
            <div class="glass-card">
                <h2>Analysis Results</h2>
                <div id="results-content">
                    <!-- Results will be populated here -->
                </div>
            </div>
        </div>

        <!-- Quick Start Examples -->
        <div class="mt-4">
            <h3>Quick Start Examples</h3>
            <div class="grid-3">
                <div class="glass-card" onclick="loadExample('apoptosis')">
                    <h4>Apoptosis Analysis</h4>
                    <p>Compare key apoptosis regulators: TP53, BAX, BCL2, CASP3</p>
                </div>
                <div class="glass-card" onclick="loadExample('cell_cycle')">
                    <h4>Cell Cycle Control</h4>
                    <p>Analyze cell cycle kinases: CDK1, CDK2, CDK4, RB1</p>
                </div>
                <div class="glass-card" onclick="loadExample('pi3k_pathway')">
                    <h4>PI3K/AKT Pathway</h4>
                    <p>Investigate PI3K signaling: AKT1, PTEN, mTOR, GSK3B</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function compareProteins() {
        const proteinList = document.getElementById('protein-list').value.trim();
        if (!proteinList) {
            alert('Please enter at least 2 protein names');
            return;
        }

        const proteins = proteinList.split('\n').map(p => p.trim()).filter(p => p.length > 0);
        if (proteins.length < 2) {
            alert('Please enter at least 2 protein names');
            return;
        }

        showResults('Protein Comparison', `
            <p>Comparing phosphorylation profiles for: <strong>${proteins.join(', ')}</strong></p>
            <p style="color: var(--text-secondary);">
                This analysis would compare site counts, confidence distributions, kinase predictions,
                and pathway associations across the selected proteins.
            </p>
            <div class="mt-3">
                <button class="btn btn-secondary" onclick="exportResults()">
                    <i class="fas fa-download"></i>
                    Export Results
                </button>
            </div>
        `);
    }

    function analyzeEnrichment() {
        const geneList = document.getElementById('gene-list').value.trim();
        if (!geneList) {
            alert('Please enter a gene list');
            return;
        }

        const genes = geneList.split('\n').map(g => g.trim()).filter(g => g.length > 0);

        showResults('Pathway Enrichment Analysis', `
            <p>Analyzing pathway enrichment for <strong>${genes.length} genes</strong>: ${genes.join(', ')}</p>
            <p style="color: var(--text-secondary);">
                This analysis would identify statistically enriched pathways, calculate p-values,
                and provide functional annotations for the gene set.
            </p>
            <div class="mt-3">
                <button class="btn btn-secondary" onclick="exportResults()">
                    <i class="fas fa-download"></i>
                    Export Enrichment
                </button>
            </div>
        `);
    }

    function analyzeKinase() {
        const kinase = document.getElementById('kinase-select').value;

        showResults('Kinase Substrate Analysis', `
            <p>Analyzing predicted substrates for kinase: <strong>${kinase}</strong></p>
            <p style="color: var(--text-secondary);">
                This analysis would rank potential substrates by prediction confidence,
                show motif preferences, and provide functional context.
            </p>
            <div class="mt-3">
                <button class="btn btn-secondary" onclick="viewKinase('${kinase}')">
                    <i class="fas fa-external-link-alt"></i>
                    View in Kinase Explorer
                </button>
            </div>
        `);
    }

    function analyzeStructure() {
        const structureType = document.getElementById('structure-type').value;
        const typeNames = {
            'disorder': 'Intrinsic Disorder Analysis',
            'secondary': 'Secondary Structure Patterns',
            'surface': 'Surface Accessibility Analysis',
            'conservation': 'Conservation Analysis'
        };

        showResults(typeNames[structureType], `
            <p>Performing <strong>${typeNames[structureType].toLowerCase()}</strong></p>
            <p style="color: var(--text-secondary);">
                This analysis would examine structural features, calculate distributions,
                and identify patterns in phosphorylation site architecture.
            </p>
            <div class="mt-3">
                <button class="btn btn-secondary" onclick="exportResults()">
                    <i class="fas fa-download"></i>
                    Export Analysis
                </button>
            </div>
        `);
    }

    function showResults(title, content) {
        document.getElementById('results-section').style.display = 'block';
        document.getElementById('results-content').innerHTML = `
            <h3>${title}</h3>
            ${content}
        `;

        // Scroll to results
        document.getElementById('results-section').scrollIntoView({
            behavior: 'smooth'
        });
    }

    function loadExample(example) {
        const examples = {
            'apoptosis': ['TP53', 'BAX', 'BCL2', 'CASP3', 'CASP9'],
            'cell_cycle': ['CDK1', 'CDK2', 'CDK4', 'RB1', 'CCND1'],
            'pi3k_pathway': ['AKT1', 'PTEN', 'MTOR', 'GSK3B', 'PIK3CA']
        };

        if (examples[example]) {
            document.getElementById('protein-list').value = examples[example].join('\n');
            document.getElementById('gene-list').value = examples[example].join('\n');
        }
    }

    function viewKinase(kinase) {
        window.location.href = `/kinases?kinase=${kinase}`;
    }

    function exportResults() {
        alert('Export functionality would download results as CSV, JSON, or PDF format.');
    }
</script>
{% endblock %}